/// @spec_ref: 9.1
/// @point_id: 9_1_trait
/// @case_id: 9_1_trait__core_pass
/// @expect: pass
/// @boundary: core
/// @phase: sema
/// @diag_codes:
/// @diag_keywords:
// Trait 定义 — 抽象方法 + 带默认实现方法，验证 dispatch 返回值

trait Measure {
    func size(&self) -> i32

    // 默认实现：doubled size
    func doubled(&self) -> i32 {
        return self.size() * 2
    }
}

struct Small {}
struct Large {}

impl Measure for Small {
    func size(&self) -> i32 {
        return 5
    }
}

impl Measure for Large {
    func size(&self) -> i32 {
        return 100
    }

    // 覆盖默认方法
    func doubled(&self) -> i32 {
        return self.size() * 3
    }
}

func main() -> i32 {
    var s = Small {}
    var l = Large {}

    // 抽象方法调用
    @assert(s.size() == 5, "9.1 trait: Small.size")
    @assert(l.size() == 100, "9.1 trait: Large.size")

    // 默认方法实现
    @assert(s.doubled() == 10, "9.1 trait: Small.doubled (default)")

    // 覆盖默认方法
    @assert(l.doubled() == 300, "9.1 trait: Large.doubled (override)")

    return 0
}
