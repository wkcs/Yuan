/// @spec_ref: 3.3.6
/// @point_id: 3_3_6_optional
/// @case_id: 3_3_6_optional__core_pass
/// @expect: pass
/// @boundary: core
/// @phase: sema
/// @diag_codes:
/// @diag_keywords:
// Optional 类型（?T） — orelse、is_some/is_none、match Some/None

func try_parse(n: i32) -> ?i32 {
    if n < 0 {
        return None
    }
    return n * 10
}

func main() -> i32 {
    // ?T 赋值与 orelse 默认值
    var some_val: ?i32 = 42
    var none_val: ?i32 = None
    var r1: i32 = some_val orelse 0
    var r2: i32 = none_val orelse 99
    @assert(r1 == 42, "3.3.6 optional: some orelse")
    @assert(r2 == 99, "3.3.6 optional: none orelse")

    // match Some/None
    var out1: i32 = match some_val {
        Some(v) => v + 1,
        None => -1,
    }
    @assert(out1 == 43, "3.3.6 optional: match Some")

    var out2: i32 = match none_val {
        Some(v) => v,
        None => 0,
    }
    @assert(out2 == 0, "3.3.6 optional: match None")

    // 函数返回 Optional
    var p1 = try_parse(5)
    var p2 = try_parse(-1)
    var v1: i32 = p1 orelse 0
    var v2: i32 = p2 orelse -99
    @assert(v1 == 50, "3.3.6 optional: func Some result")
    @assert(v2 == -99, "3.3.6 optional: func None result")

    return 0
}
